<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="__PUBLIC__/css/bootstrap.css">
	<link rel="stylesheet" href="__PUBLIC__/css/bootstrap-theme.css">
	<style>
		*{
			font-family:"微软雅黑";
		}
		h3{
			margin:5px 0;
			padding-left:10px;
			color:#FFFFFF;
		}
		#TB01 thead tr{
			background-color: #5D5D5D;
		}
		#TB01 th{
			color:#FFFFFF;
		}
		#TB01 tbody tr:hover{
			background-color: #C8C8C8;
			cursor:pointer;
		}
		table tbody {
	        display:block;
	    }
	    table thead, tbody tr {
	        display:table;
	        width:100%;
	        table-layout:fixed;
	    }
	    table thead {
	        width: calc( 100% - 1em )
	    }
		.nav li a {
			color:white;
	    }
	    .nav li a:hover{
			background-color: #545454;
	    }
		.dropdown-menu{
			background-color: gray;
		}
	</style>
</head>
<body>
<div class="container-fluid" style="margin-top:15px;">
	<div class="row" style="background-color: #C60000;">
		<!--nav-->
		<div class="col-md-6 col-xs-6">
			<ul class="nav nav-pills">
	             <li><a href="__GROUP__/Msg/sendMsg">短信发送</a></li>
	             <li><a href="__GROUP__/Msg/searchMsg">短信查询</a></li>
	             <li class="dropdown active" >
	             <a class="dropdown-toggle" data-toggle="dropdown" href="#">人员分组 <b class="caret"></b></a>
	             <ul class="dropdown-menu">
	                <li><a href="__GROUP__/Msg/userManage">人员管理</a></li>
	                <li><a href="__GROUP__/Msg/groupManage">分组管理</a></li>
	                <li><a href="__GROUP__/Msg/userGroupRel">人员分组关系</a></li>
	             </ul>
	             </li>
        	 </ul>
		</div>
		<!--end nav-->
	</div>
	<br>
	<div class="row">
		<div class="col-md-2 col-xs-2" >
			<div class="input-group">
		      	<input type="text" class="form-control" placeholder="Search for..." id="keyword">
		      	<span class="input-group-btn">
		        	<button class="btn btn-default" type="button" id="search">查询</button>
		      	</span>
		    </div>
		</div>
		<div class="col-md-6 col-xs-6" >
			<button type="button" class="btn btn-primary" id="add"  data-toggle="modal" data-target=".YTDJ" id="add">添加用户</button>
		</div>
	</div>
	<br>	
	<!-- 用户表 -->
	<div class="row">
		<div class="col-md-12 col-xs-12" >
		   <table class="table table-striped" id="TB01">
		   		<thead>
		   			<tr>
						<th>姓名</th>
						<th>手机号</th>
						<th>职务</th>
						<th>单位</th>
						<th>备注</th>
						<th>状态</th>
						<th>操作</th>
					</tr>
		   		</thead>
		   		<tbody>
		   			
		   		</tbody>
			</table>
			<div id="page"></div>
		</div>
	</div>
	<!-- end 用户表 -->
	
<!-- 添加用户弹窗 -->	
<form id="form1" method="post">
	<div class="modal fade YTDJ" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
		<div class="modal-dialog modal-mi"  role="document" style="width:1000px;margin-top: 200px;">
		    <div class="modal-content">
		      	<div class="panel-heading" style="background-color:#F27D09;"><h3>添加用户</h3></div>
		      	<div class="panel-body" style="padding:25px;">
		  			<div class="row">
		  				<div class="col-xs-6">
						   	<div class="form-inline">
							  <div class="form-group">
							    <label for="YTRQ" style="margin-right:5px">用户姓名：</label>
							    <input type="text" class="form-control" style="width:300px;" name="name" >
							  </div>
							</div>
						</div>
						<div class="col-xs-6">
						   	<div class="form-inline">
							  <div class="form-group">
							    <label for="JSSJ" style="margin-right:5px">用户职务：</label>
							    <input type="text" class="form-control"  style="width:300px;" name="duty" >
							  </div>
							</div>
						</div>
					</div>
					<br>
					<div class="row">
		  				<div class="col-xs-6">
						   	<div class="form-inline">
							  <div class="form-group">
							    <label for="JSSJ" style="margin-right:5px">所属单位：</label>
							      <input type="text" class="form-control"  style="width:300px;" name="depart" >
							  </div>
							</div>
						</div>
						<div class="col-xs-6">
						   	<div class="form-inline">
							  <div class="form-group">
							    <label for="JSSJ" style="margin-right:5px">手机号码：</label>
							      <input type="text" class="form-control"  style="width:300px;" name="phone" onblur="validatemobile1();" id="phone">
							  </div>
							</div>
						</div>
					</div>
					<br>
					<div class="row">
						<div class="col-xs-6">
		  					启用：<input name="ifuse" type="radio" value=1 checked="checked" />
		  					不启用：<input name="ifuse" type="radio" value=0 />
		  				</div>
		  				<div class="col-xs-6"></div>
					</div>
					<br>
					<div class="row">
						<div class="col-xs-12">
		  					<textarea class="form-control" rows="2" placeholder="备注" name="comment"></textarea>
		  				</div>
					</div>
					<br>
					<div class="row">
		  				<div class="col-xs-3 center"></div>
		  				<div class="col-xs-3 center"><button type="button" class="btn btn-primary btn-lg btn-block" id="save" value="save">提交</button></div>
		  				<div class="col-xs-3 center"><button type="reset" class="btn btn-success btn-lg btn-block" >重置</button></div>
		  				<div class="col-xs-3 center"></div>
					</div>
				</div>
		    </div>
		</div>
	</div>
</form>
<!-- 添加用户弹窗 结束-->				

<!-- 编辑用户弹窗 -->	
<form id="form2" method="post">
	<div class="modal fade YTDJ2" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
		<div class="modal-dialog modal-mi"  role="document" style="width:1000px;margin-top: 200px;">
		    <div class="modal-content">
		      	<div class="panel-heading" style="background-color:#4EA7BB;"><h3>编辑用户</h3></div>
		      	<div class="panel-body" style="padding:25px;">
		  			<div class="row">
		  				<div class="col-xs-6">
						   	<div class="form-inline">
							  <div class="form-group">
							    <label for="YTRQ" style="margin-right:5px">用户姓名：</label>
							    <input type="text" class="form-control" style="width:300px;" name="name" >
							  </div>
							</div>
						</div>
						<div class="col-xs-6">
						   	<div class="form-inline">
							  <div class="form-group">
							    <label for="JSSJ" style="margin-right:5px">用户职务：</label>
							    <input type="text" class="form-control"  style="width:300px;" name="duty" >
							  </div>
							</div>
						</div>
					</div>
					<br>
					<div class="row">
		  				<div class="col-xs-6">
						   	<div class="form-inline">
							  <div class="form-group">
							    <label for="JSSJ" style="margin-right:5px">所属单位：</label>
							      <input type="text" class="form-control"  style="width:300px;" name="depart" >
							  </div>
							</div>
						</div>
						<div class="col-xs-6">
						   	<div class="form-inline">
							  <div class="form-group">
							    <label for="JSSJ" style="margin-right:5px">手机号码：</label>
							      <input type="text" class="form-control"  style="width:300px;" name="phone" onblur="validatemobile2();" id="phone2">
							  </div>
							</div>
						</div>
					</div>
					<br>
					<div class="row">
						<div class="col-xs-6">
		  					启用：<input name="ifuse" type="radio" value=1 checked="checked" />
		  					不启用：<input name="ifuse" type="radio" value=0 />
		  				</div>
		  				<div class="col-xs-6"></div>
					</div>
					<br>
					<div class="row">
						<div class="col-xs-12">
		  					<textarea class="form-control" rows="2" placeholder="备注" name="comment"></textarea>
		  				</div>
					</div>
					<br>
					<div class="row">
		  				<div class="col-xs-3 center"></div>
		  				<div class="col-xs-3 center"><button type="button" class="btn btn-primary btn-lg btn-block" id="edit" >提交</button></div>
		  				<div class="col-xs-3 center"><button type="reset" class="btn btn-success btn-lg btn-block" >重置</button></div>
		  				<div class="col-xs-3 center"></div>
					</div>
					<input type="hidden" value="" id="userId" name="id" />
				</div>
		    </div>
		</div>
	</div>
</form>
<!-- 编辑用户弹窗 结束-->				
	
</div>

<script src="__PUBLIC__/js/jquery-3.2.1.js"></script>
<script src="__PUBLIC__/js/bootstrap.js"></script>
<script>
$(function (){
	//添加用户操作
	$("#save").click(function(){
		if(!$("#phone").val()){
			alert("请填写手机号！");
			return false;
		}
		$.ajax({
			url: '/index.php/Msg/addUserHandler',
			dataType: 'json',
			type: 'POST',
			cache:false,
			data:$("#form1").serialize(),
			success: function(msg){
				if(msg.status){
					$('#form1')[0].reset(); //重置表单
					$("#search").click();
					alert("操作成功");
				}else{
					alert("操作失败");
				}
			},
			error:function(){
				alert("发生错误！");
			}
		});
	});
	
	//查询用户
	$("#search").click(function(){
		var data="&nowPage=1&condition=1&keyword="+$("#keyword").val();
		$.ajax({
			url: '/index.php/Msg/ajaxGetUser',
			dataType: 'json',
			type: 'POST',
			cache:false,
			data:data,
			success: function(msg) {
				if(msg.status){
					$('#page').html(msg.data[0]);
					$('#TB01 tbody').html(msg.data[1]);
				}else{
					
				}
			},
			error:function(){
				alert("发生错误！");
			}
		});
	});
	
	//分页ajax读取
	$("#page").delegate("a","click",function(){
	var nowPage=$(this).attr('page');
	var data="nowPage="+nowPage;
	$.ajax({
		url: '/index.php/Home/Msg/ajaxGetUser',
		dataType: 'json',
		type: 'POST',
		cache:false,
		data:data,
		success: function(msg) {
			if(msg.status){
				$('#page').html(msg.data[0]);
				$('#TB01 tbody').html(msg.data[1]);
			}else{
				
			}
		},
		error:function(){
			alert("发生错误！");
		}
	});
});

//编辑用户
$("#TB01 tbody").delegate("button[class='btn btn-info']","click",function(){
	var id=$(this).attr('id');
	var data="id="+id;
	$.ajax({
		url: '/index.php/Home/Msg/getEditUser',
		dataType: 'json',
		type: 'POST',
		cache:false,
		data:data,
		success: function(msg) {
			if(msg.status){
				$('#form2')[0].reset(); //重置表单
				$("#userId").val("");
				$("#form2 input[name='name']").val(msg.data.name);
				$("#form2 input[name='duty']").val(msg.data.duty);
				$("#form2 input[name='depart']").val(msg.data.depart);
				$("#form2 input[name='phone']").val(msg.data.phone);
				$("#form2 textarea[name='comment']").val(msg.data.comment);
				if(msg.data.ifuse==1){
					$("#form2 input[name='ifuse'][value=1]").prop("checked",true);
				}else{
					$("#form2 input[name='ifuse'][value=0]").prop("checked",true);
				}
				$("#userId").val(id);
			}
		},
		error:function(){
			alert("发生错误！");
		}
	});
});

//编辑操作
$("#edit").click(function(){
	if(!$("#phone2").val()){
		alert("请填写手机号！");
		return false;
	}
	$.ajax({
		url: '/index.php/Msg/editUserHandler',
		dataType: 'json',
		type: 'POST',
		cache:false,
		data:$("#form2").serialize(),
		success: function(msg){
			if(msg.status){
				$("#search").click();
				alert("操作成功");
			}else{
				alert("操作失败");
			}
		},
		error:function(){
			alert("发生错误！");
		}
	});
});

$("#search").click();
	
});


//手机号验证1
function validatemobile1() 
{ 
	var mobile=$("#phone").val();
    if(mobile.length==0) 
    { 
       alert('请输入手机号码！'); 
       $("#phone").val('');
       return false; 
    }     
    if(mobile.length!=11) 
    { 
        alert('请输入有效的手机号码！'); 
        $("#phone").val('');
        return false; 
    } 
     
    var myreg=/^1[3|4|5|7|8][0-9]{9}$/;
    if(!myreg.test(mobile)) 
    { 
        alert('请输入有效的手机号码！'); 
        $("#phone").val('');
        return false; 
    } 
} 

//手机号验证2
function validatemobile2() 
{ 
	var mobile=$("#phone2").val();
    if(mobile.length==0) 
    { 
       alert('请输入手机号码！'); 
       $("#phone2").val('');
       return false; 
    }     
    if(mobile.length!=11) 
    { 
        alert('请输入有效的手机号码！'); 
        $("#phone2").val('');
        return false; 
    } 
     
    var myreg=/^1[3|4|5|7|8][0-9]{9}$/;
    if(!myreg.test(mobile)) 
    { 
        alert('请输入有效的手机号码！'); 
        $("#phone2").val('');
        return false; 
    } 
} 
</script>
</body>
</html>