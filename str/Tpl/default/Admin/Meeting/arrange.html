<include file="Public/header" />
<link rel="stylesheet" href="__PUBLIC__/css/chosen.css" />
	<body class="no-skin" >
					<div class="row">
						<div class="col-xs-12">
							<div class="table-header" style="background-color: rgb(48,126,204);">
								<i class="ace-icon fa fa-table"></i>&nbsp&nbsp任务详情
							</div>
							<!-- <div class="dataTables_borderWrap"> -->
							<div>
								<div class="col-xs-6">
									<input type="hidden" id="taskID" value="{$taskID}" />
									<button class="btn btn-sm btn-success allSend" style="margin:5px 0">
										全部发送
										<i class="ace-icon fa fa-share icon-on-right align-middle"></i>
									</button>
								</div>
								<table id="table1" class="table table-striped table-bordered table-hover" >
									<thead>
										<tr>
											<th>DATE</th>
											<th>WEEK</th>
											<th>CHANNEL</th>
											<th>TIME</th>
											<th>STUDIO</th>
											<th>PROGRAM</th>
											<th>PD</th>
											<th>SH</th>
											<th>MD</th>
											<th>MEMO</th>
											<th>会议室</th>
											<th>开始时间</th>
											<th>结束时间</th>
											<th>导演反馈</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody>
									<volist name="program" id="vo">
										<tr>
											<td>{$vo.ProgramDate}</td>
											<td>{$vo.ProgramWeek}</td>
											<td>{$vo.BroadChannel}</td>
											<td>{$vo.BroadTime}</td>
											<td>{$vo.VideoSite}</td>
											<td>{$vo.ProgramReq}</td>
											<td>{$vo.PD}</td>
											<td>{$vo.SH}</td>
											<td>{$vo.MD}</td>
											<td>{$vo.MEMO}</td>
											<td>{$vo.RoomName}</td>
											<td>{$vo.MeetStartTime}</td>
											<td>{$vo.MeetEndTime}</td>
											<td><if condition="$vo.PD_Already eq 1">确认参加<elseif condition="$vo.IfChange eq 1" />{$vo.ChangeReason}</if></td>
											<td>
													<if condition="($vo.PD neq '' ) AND ($vo.SH neq '' ) AND ($vo.MD neq '') AND ($vo.MeetSenderID eq '')"><button  class="btn btn-xs btn-info" programID="{$vo.Id}">选择会议室</button></if>
													<if condition="($vo.PD neq '' ) AND ($vo.SH neq '' ) AND ($vo.MD neq '') AND ($vo.MeetSenderID eq '')"><button  class="btn btn-xs btn-warning" programID="{$vo.Id}">修改导演主持</button></if>
													<if condition="($vo.PD neq '' ) AND ($vo.SH neq '' ) AND ($vo.MD neq '') AND ($vo.MeetSenderID eq '') AND ($vo.RoomID neq '')"><button  class="btn btn-xs btn-success" programID="{$vo.Id}">发送</button></if>
											</td>
										</tr>
									</volist>
								</tbody>
							</table>
							</div><!-- end<div class="dataTables_borderWrap"> -->
						</div><!-- end col -->
					</div><!-- end row -->
					<br>	
					<!-- 会议室表格 -->
					<div class="room_borderWrap">		
						<div class="nav-search" id="nav-search">
							<p>
								<input type="text" placeholder="人数" id="maxPeople"  />
								<input type="text" placeholder="开始时间" id="meetStartTime" onclick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" />
								<input type="text" placeholder="结束时间" id="meetEndTime" onclick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" />
								<button class="btn btn-success btn-sm">查询<i class="ace-icon fa fa-search icon-on-right bigger-110"></i></button>
							</p>
						</div>
						<div class="room" id="room">
							<volist name="room" id="vo">
								<div class="pricing-span" style="margin-left:5px;">
									<div class="widget-box pricing-box-small widget-color-blue">
										<div class="widget-header">
											<h5 class="widget-title bigger lighter">{$vo.RoomName}</h5>
										</div>
										<div class="widget-body">
											<div class="widget-main no-padding">
												<ul class="list-unstyled list-striped pricing-table">
													<div class="room-image">
														<img src="{$vo.RoomPicDir}"  id="{$vo.Id}" style="cursor:pointer" />
													</div>
													<li>{$vo.RoomSquare}平方</li>
													<li>{$vo.MaxPeople}人</li>
													<li><if condition="$vo.RoomEquipment eq ''" >-<else />{$vo.RoomEquipment}</if>
													</li>
												</ul>
											</div>
											<div>
												<a href="#" class="btn btn-block btn-sm btn-primary" id="{$vo.Id}" >
													<span>选择</span>
												</a>
											</div>
										</div>
									</div>
								</div>
							</volist>
								<!-- <ul class="pager">
											<li class="next">
												<a href="#">close ×</a>
											</li>
								</ul> -->
						</div>
						<p id="page" class="center">{$page}</p>
					</div>
					<!-- 会议室表格 End-->	
					<input type="hidden" id="programID" />
								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content-area -->
				</div><!-- /.page-content -->
			</div><!-- /.main-content -->

<include file="Public/footer" />
<script src="__PUBLIC__/js/chosen.jquery.min.js"></script>
<script src="/Public/My97DatePicker/WdatePicker.js"></script>
	<script type="text/javascript">
		jQuery(function($){
			//加载layer扩展方法
			layer.config({
			    extend: 'extend/layer.ext.js'
			});       
			$('.room_borderWrap').slideUp();
			$('#table1').dataTable({
				searching: true,
				lengthChange: false,
				lengthMenu: [6],
				stateSave: true,//保存表格状态
				language:{
		            "url": "/Public/font/zh_CN.txt"
		    	}
			});
			
			
		});
		
		//【选择会议室】按钮
		$("button[class='btn btn-xs btn-info']").click(function(){
			$("#programID").val($(this).attr("programID"));
			cancelSelected();
			$(this).css("border-color","orange");
			$(".room_borderWrap").slideDown();
		});

		//【变更会议室】按钮
		$("button[class='btn btn-xs btn-pink']").click(function(){
			cancelSelected();
			$(this).css("border-color","orange");
			$(".room_borderWrap").slideDown();
		});

		//【修改导演主持】按钮
		$("button[class='btn btn-xs btn-warning']").click(function(){
			var programID=$(this).attr("programID");
			var index = layer.open({
			    type: 2,
			    title:"修改导演主持",
			    content:'/index.php/Meeting/editPDSH?programID='+programID,
			    area: ['400px','255px'],
			    maxmin: false
			});
		});
		
		//【单条发送会议通知】按钮
		$("button[class='btn btn-xs btn-success']").click(function(){
			var programID=$(this).attr("programID");
			layer.confirm('是否发送?', {icon: 3, title:'提示'}, function(index){
				$.ajax({
					url: '/index.php/Meeting/sendMeetingRoom?programID='+programID,
					dataType: 'json',
					type: 'GET',
					success: function(msg) {
						if(!msg.status){
							//发送失败
							layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
						}else{
							//发送成功
							layer.alert(msg.info, {icon: 1},function(index){location.reload();}); 
						}
					}
				});
			});
		});
		
		//【发送全部会议通知】按钮
		$("button[class='btn btn-sm btn-success allSend']").click(function(){
			var taskID=$("#taskID").val();
			layer.confirm('是否全部发送?', {icon: 3, title:'提示'}, function(index){
				$.ajax({
					url: '/index.php/Meeting/sendAllMeetingRoom?taskID='+taskID,
					dataType: 'json',
					type: 'GET',
					success: function(msg) {
						if(!msg.status){
							//发送失败
							layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
						}else{
							//发送成功
							layer.alert(msg.info, {icon: 1},function(index){location.reload();}); 
						}
					}
				});
			});
		});
		
		//会议室【选择】按钮，弹出会议时间
		$(".room").delegate('a','click',function(){
			var id=$(this).attr('id');
			var programID=$("#programID").val();
			var meetStartTime=$('#meetStartTime').val();
			var meetEndTime=$('#meetEndTime').val();
			var index = layer.open({
			    type: 2,
			    title:"会议时间",
			    content:'/index.php/Meeting/meetingTime?id='+id+"&programID="+programID+"&meetStartTime="+meetStartTime+"&meetEndTime="+meetEndTime,
			    area: ['400px', '350px'],
			    maxmin: false
			});
			//cancelSelected();
			//$(".room_borderWrap").slideUp();
		});
		
		//【会议室预订时间】层
		$(".room").delegate('img','click',function(){
			var roomID=$(this).attr("id");
			var index = layer.open({
			    type: 2,
			    content: '/index.php/Meeting/roomTimeList?roomID='+roomID,
			    area: ['500px', '400px'],
			    maxmin: false
			});
		});
		
		//会议室分页跳转
		$("#page").delegate('a','click',function(){
			var url=$(this).attr('href');
			var page=url.substr(url.length-1,1);
			var maxPeople=$('#maxPeople').val();
			var meetStartTime=$('#meetStartTime').val();
			var meetEndTime=$('#meetEndTime').val();
			var date=$('#date').val();
			$.ajax({
						url: '/index.php/Meeting/ajaxRoomPage?p='+page+"&maxPeople="+maxPeople+"&meetStartTime="+meetStartTime+"&meetEndTime="+meetEndTime,
						dataType: 'json',
						type: 'GET',
						success: function(msg) {
							if(msg.status){
								$("#room").html(msg.data.room);
								$("#page").html(msg.data.show);
							}else{
								$("#page").html(msg.info);
							}
						}
					});
			return false;
		});
		
		//按条件查询会议室
		$("button[class='btn btn-success btn-sm']").click(function(){
			var maxPeople=$('#maxPeople').val();
			var meetStartTime=$('#meetStartTime').val();
			var meetEndTime=$('#meetEndTime').val();
			$.ajax({
				url: '/index.php/Meeting/ajaxRoomPage?maxPeople='+maxPeople+"&meetStartTime="+meetStartTime+"&meetEndTime="+meetEndTime,
				dataType: 'json',
				type: 'GET',
				success: function(msg) {
					if(msg.status){
						$("#room").html(msg.data.room);
						$("#page").html(msg.data.show);
					}else{
						$("#room").html("");
						$("#page").html(msg.info);
					}
				}
			});
		});
		
		//取消按钮边框颜色
		function cancelSelected(){
			$("button[class='btn btn-xs btn-info']").css("border-color","#6fb3e0");
			$("button[class='btn btn-xs btn-success']").css("border-color","#87b87f");
		}
		</script>
	</body>
</html>
