<include file="Public/header" />
	<body class="no-skin" style="padding:16px;">
		<div class="row">
			<table id="table1" class="table table-striped table-bordered table-hover" >
				<thead>
					<tr>
						<th>DATE</th>
						<th>WEEK</th>
						<th>CHANNEL</th>
						<th>TIME</th>
						<th>STUDIO</th>
						<th>PROGRAM</th>
						<th>MD</th>
						<th>嘉宾</th>
						<th>MEMO</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
			<volist name="program" id="vo">
					<if condition="$vo.PassOrNot eq 0"><tr><else /><tr style="color:red;"></if>
						<td>{$vo.ProgramDate}</td>
						<td>{$vo.ProgramWeek}</td>
						<td>{$vo.BroadChannel}</td>
						<td>{$vo.BroadTime}</td>
						<td>{$vo.VideoSite}</td>
						<td>{$vo.ProgramReq}</td>
						<td>{$vo.MD}</td>
						<td>{$vo.Guest}</td>
						<td>{$vo.MEMO}</td>
						<td>
							<if condition="$vo.PassOrNot eq 0">
								<button class="btn btn-xs btn-danger" id="{$vo.Id}">不通过</button>
							</if>
							<if condition="$vo.PassOrNot eq 2">
								{$vo.Reason}
							</if>
						</td>
					</tr>
				</volist>
			</tbody>
		</table>
		<br><br>
		<p class="center">
			<if condition="$button eq 1">
				<a class="fm-button ui-state-default ui-corner-all fm-button-icon-left btn btn-sm btn-primary" id="allPass"><i class="ace-icon fa fa-check"></i>一次通过</a>
			</if>
			<if condition="$button eq 2">
				<a class="fm-button ui-state-default ui-corner-all fm-button-icon-left btn btn-sm btn-danger" id="allReturn"><i class="ace-icon fa fa-undo"></i>退回修改</a>
			</if>
		</p>
	</div>
	<input type="hidden" id="taskID" value={$taskID} > 
<include file="Public/footer" />
<script type="text/javascript">
		jQuery(function($){
			//加载layer扩展方法
			layer.config({
			    extend: 'extend/layer.ext.js'
			});       
			//表格初始化
			$('#table1').dataTable({
				lengthMenu: [[10, 15, 20, -1], [10, 15, 20, "All"]],
				info: true,
				stateSave: true,//保存表格状态
				language:{
			            "url": "/Public/font/zh_CN.txt"
			    }
			});
			
			/* //点击【通过】
			$("#table1").delegate("button[class='btn btn-xs btn-success']","click",function(){
				var id=$(this).attr('id');
				$.ajax({
					url: '/index.php/Audit/passSingleAuditHandler?id='+id,
					dataType: 'json',
					type: 'GET',
					success: function(msg) {
						if(!msg.status){
							//删除失败
							layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
						}else{
							//删除成功
							//layer.alert(msg.info, {icon: 1},function(index){location.reload();}); 
							//window.location.reload();
						}
					}
				});
			}); */
			
			//点击【不通过】,弹出不通过原因层
			$("#table1").delegate("button[class='btn btn-xs btn-danger']","click",function(){
				var id=$(this).attr('id');
				var index = layer.open({
				    type: 2,
				    content: '/index.php/Audit/reason_layer?id='+id,
				    area: ['350px', '220px'],
				});
			});
				
			//【全部通过】
			$("#allPass").bind("click", function () {
				var taskID=$("#taskID").val();
				layer.confirm('确认全部通过?', {icon: 3, title:'提示'}, function(index){
					$.ajax({
						url: '/index.php/Audit/allPassHandler?taskID='+taskID,
						dataType: 'json',
						type: 'GET',
						success: function(msg) {
							if(!msg.status){
								//删除失败
								layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
							}else{
								//删除成功
								layer.alert(msg.info, {icon: 1},function(index){parent.location.reload();}); 
							}
						}
					});
				});
            });
			
			//【退回修改】
			$("#allReturn").bind("click", function () {
				var taskID=$("#taskID").val();
				layer.confirm('确认退回修改?', {icon: 3, title:'提示'}, function(index){
					$.ajax({
						url: '/index.php/Audit/allReturnHandler?taskID='+taskID,
						dataType: 'json',
						type: 'GET',
						success: function(msg) {
							if(!msg.status){
								//删除失败
								layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
							}else{
								//删除成功
								layer.alert(msg.info, {icon: 1},function(index){parent.location.reload();}); 
							}
						}
					});
				});
            });
			
		});
		</script>
	</body>
</html>
