<include file="Public/header" />
<link rel="stylesheet" href="__PUBLIC__/css/chosen.css" />
<body class="no-skin">
		<!-- #section:basics/navbar.layout -->
		<div id="navbar" class="navbar navbar-default">
			<script type="text/javascript">
				try{ace.settings.check('navbar' , 'fixed')}catch(e){}
			</script>

			<div class="navbar-container" id="navbar-container">
				<!-- #section:basics/sidebar.mobile.toggle -->
				<button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler">
					<span class="sr-only">Toggle sidebar</span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>
				</button>

				<!-- /section:basics/sidebar.mobile.toggle -->
				<div class="navbar-header pull-left">
					<!-- #section:basics/navbar.layout.brand -->
					<a href="#" class="navbar-brand">
						<small>
							<img src="__PUBLIC__/images/cj_logo.png" width="25" height="25">
							东方购物质效考核系统
						</small>
					</a>
					<!-- /section:basics/navbar.layout.brand -->
				</div>
<include file="Public/userbar" />
			</div><!-- /.navbar-container -->
		</div>

		<!-- /section:basics/navbar.layout -->
		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<!-- #section:basics/sidebar -->
			<div id="sidebar" class="sidebar responsive">
				<script type="text/javascript">
					try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
				</script>

<include file="Public/menu" />

				<!-- #section:basics/sidebar.layout.minimize -->
				<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
					<i class="ace-icon fa fa-angle-double-left" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
				</div>

				<!-- /section:basics/sidebar.layout.minimize -->
				<script type="text/javascript">
					try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
				</script>
			</div>

			<!-- /section:basics/sidebar -->
			<div class="main-content">
				<!-- #section:basics/content.breadcrumbs -->
				<div class="breadcrumbs" id="breadcrumbs">
					<script type="text/javascript">
						try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
					</script>
					<!-- /section:basics/content.searchbox -->
				</div>
				<!-- /section:basics/content.breadcrumbs -->
				<div class="page-content">
					<div class="page-content-area">
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
					<div class="row">
						<div class="col-xs-12">
							<div class="table-header" style="background-color: rgb(48,126,204);">
								<i class="ace-icon fa fa-table"></i>&nbsp&nbsp本周及下周任务
							</div>
							<!-- <div class="dataTables_borderWrap"> -->
							<div>
								<table id="table1" class="table table-striped table-bordered table-hover" >
									<thead>
										<tr>
											<th>DATE</th>
											<th>WEEK</th>
											<th>CHANNEL</th>
											<th>TIME</th>
											<th>MEMO</th>
											<th>STUDIO</th>
											<th>PROGRAM</th>
											<th>PD</th>
											<th>SH</th>
											<th>MD</th>
											<th>拍摄地点</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody>
									<volist name="program" id="vo">
										<tr>
											<td>{$vo.ProgramDate}</td>
											<td>{$vo.ProgramWeek}</td>
											<td>{$vo.BroadChannel}</td>
											<td>{$vo.BroadTime}</td>
											<td>{$vo.MEMO}</td>
											<td>{$vo.VideoSite}</td>
											<td>{$vo.ProgramReq}</td>
											<td>{$vo.PD}</td>
											<td>{$vo.SH}</td>
											<td>{$vo.MD}</td>
											<td><if condition="$vo.IfGoOut eq 1" >外拍<else />棚拍</if></td>
											<td>
											<if condition="$vo.IfSelectedModel eq 1">
												<button  class="btn btn-xs btn-warning" programID="{$vo.Id}"  ifGoOut="{$vo.IfGoOut}">模特修改</button>
											<else />
												<if condition="$vo.IfGoOut eq 1">
													<button  class="btn btn-xs btn-primary"  programID="{$vo.Id}"  ifGoOut="{$vo.IfGoOut}" workTime="am">申请(上午)</button>
													<button  class="btn btn-xs btn-primary"  programID="{$vo.Id}"  ifGoOut="{$vo.IfGoOut}" workTime="pm">申请(下午)</button>
												<else />
													<button  class="btn btn-xs btn-primary"  programID="{$vo.Id}"  ifGoOut="{$vo.IfGoOut}">模特申请</button>
												</if>
											</if>
											</td>
										</tr>
									</volist>
								</tbody>
							</table>
							</div><!-- end<div class="dataTables_borderWrap"> -->
						</div><!-- end col -->
					</div><!-- end row -->
					<br>	
					<!-- 选择模特表单 -->
					<div class="widget-box row" id="send1">
						<div class="widget-header widget-header-flat">
							<h4 class="smaller">可选择档期模特</h4>
						</div>
						<div class="widget-body col-xs-12">
							<div class="widget-main row">
							<form id="form1" class="col-xs-12" onsubmit="return false">
									<div id="model1"></div>
									<div class="col-xs-12 space-20"></div>

									<div class="col-xs-12 center">
										<a class="btn btn-sm btn-warning">确定</a>
										<a class="btn btn-sm" style="margin-left:10px">取消</a>
									</div>
								</form>
							</div>
						</div>
					</div>
					<!-- 选择模特表单 End-->
					
					<!-- 修改模特表单 -->
					<div class="widget-box row" id="send2">
						<div class="widget-header widget-header-flat">
							<h4 class="smaller">修改模特</h4>
						</div>
						<div class="widget-body col-xs-12">
							<div class="widget-main row">
							<form id="form2" class="col-xs-12" onsubmit="return false">
									<div id="model2"></div>
									<div class="col-xs-12 space-20"></div>

									<div class="col-xs-12 center">
										<a class="btn btn-sm btn-warning" update="1">确定</a>
										<a class="btn btn-sm" style="margin-left:10px">取消</a>
									</div>
								</form>
							</div>
						</div>
					</div>
					<!-- 修改模特表单 End-->

								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content-area -->
				</div><!-- /.page-content -->
			</div><!-- /.main-content -->

<include file="Public/footer" />
<script src="__PUBLIC__/js/chosen.jquery.min.js"></script>
	<script type="text/javascript">
		jQuery(function($){
			$("#send1").slideUp();
			$("#send2").slideUp();
			$('.chosen-select').chosen({allow_single_deselect:true});
			$('#table1').dataTable({
				searching: true,
				lengthChange: false,
				lengthMenu: [5],
				stateSave: true,//保存表格状态
				language:{
		            "url": "/Public/font/zh_CN.txt"
		    	}
			});

			//【模特申请】按钮
			$("button[class='btn btn-xs btn-info'],button[class='btn btn-xs btn-primary']").click(function(){
				cancelSelected();
				$("#send2").slideUp();
				$(this).css("border-color","orange");
				var programID=$(this).attr('programID');//节目ID
				var ifGoOut=$(this).attr('ifGoOut');//是否外拍
				if(ifGoOut==1){
					var workTime=$(this).attr('workTime');//时间段
				}
				$.ajax({
					url: '/index.php/Model/getFreeScheduleModel?programID='+programID+'&ifGoOut='+ifGoOut,
					dataType: 'json',
					type: 'GET',
					success: function(msg) {
						if(msg.status){
							$("#model1").html('');
							var str='<input type="hidden" value="'+programID+'" name="programID">';
							if(workTime){
								str+='<input type="hidden" value="'+workTime+'" name="workTime">';
							}
							str+='<div>模特要求 <input type="text" name="ModelRemark"></div>';
							$("#model1").append(str);
							for(i=0;i<msg.data.length;i++){
								var model ='<span class="col-xs-2" style="margin-top:10px"><ul class="ace-thumbnails middle" style="display: inline-block;">'+
									'<li style="border:none">'+
										'<a href="#" class="ace-thumbnails clearfix" data-rel="colorbox">'+
											'<img width="50" src="__PUBLIC__/avatars/shead.png">'+
											'<div class="text" style="padding:2px 4px 0 0">'+
												'<div class="inner" modelID="'+msg.data[i].ModelID+'">详细<br>资料</div>'+
											'</div>'+
										'</a>'+
									'</li>'+
								'</ul>'+
								'<label><input name="model[]" class="ace ace-checkbox-2" type="checkbox" value="'+msg.data[i].ModelID+'"><span class="lbl">'+msg.data[i].ModelName+'</span></label></span>';
								$("#model1").append(model);
							}
						}else{
							$("#model1").html('无可用模特');
						}
					}
				});
				$("#send1").slideDown();
			});
			
			
			//【模特修改】按钮
			$("button[class='btn btn-xs btn-warning']").click(function(){
				cancelSelected();
				$("#send1").slideUp();
				$(this).css("border-color","orange");
				var programID=$(this).attr('programID');//节目ID
				var ifGoOut=$(this).attr('ifGoOut');//是否外拍
				if(ifGoOut==1){
					var workTime=$(this).attr('workTime');//时间段
				}
				$.ajax({
					url: '/index.php/Model/getFreeScheduleModel?programID='+programID+'&update=1',
					dataType: 'json',
					type: 'GET',
					success: function(msg) {
						if(msg.status){
							$("#model2").html('');
							var str='<input type="hidden" value="'+programID+'" name="programID">';
							if(workTime){
								str+='<input type="hidden" value="'+workTime+'" name="workTime">';
							}
							str+='<div>模特要求 <input type="text" name="ModelRemark" value="'+msg.info+'"></div>';
							$("#model2").append(str);
							for(i=0;i<msg.data.length;i++){
								//判断是否已经选中的
								if(msg.data[i].check==1){
									var check="checked=true";
								}else{
									var check="";
								}
								var model ='<span class="col-xs-2" style="margin-top:10px"><ul class="ace-thumbnails middle" style="display: inline-block;">'+
									'<li style="border:none">'+
										'<a href="#" class="ace-thumbnails clearfix" data-rel="colorbox">'+
											'<img width="50" src="__PUBLIC__/avatars/shead.png">'+
											'<div class="text" style="padding:2px 4px 0 0">'+
												'<div class="inner" modelID="'+msg.data[i].ModelID+'">详细<br>资料</div>'+
											'</div>'+
										'</a>'+
									'</li>'+
								'</ul>'+
								'<label><input name="model[]" class="ace ace-checkbox-2" type="checkbox" value="'+msg.data[i].ModelID+'" '+check+'><span class="lbl">'+msg.data[i].ModelName+'</span></label></span>';
								$("#model2").append(model);
							}
						}else{
							$("#model2").html('无可用模特');
						}
					}
				});
				$("#send2").slideDown();
			});
			
			
			//【确定】按钮
			$("a[class='btn btn-sm btn-warning']").click(function(){
				cancelSelected();
				var update=$(this).attr("update");
				if(update==1){
					var data=$('#form2').serialize();
				}else{
					var data=$('#form1').serialize();
				}
				var model = $("input[name='model[]']:checked");
        		if(model.length < 1 || model.length > 6){
        			layer.alert("亲！模特选取范围1~6人");
        			return false;
        		}else{
        			$.ajax({
        				url: '/index.php/Model/modelApplyHandler?update='+update,
        				dataType: 'json',
        				type: 'POST',
        				data:data,
        				success: function(msg) {
        					if(!msg.status){
        						//操作失败
        						layer.alert(msg.info, {icon: 7});
        					}else if(msg.status){
        						//操作成功
        						layer.alert(msg.info, {icon: 1},function(index){location.reload();});
        					}
        				}
        			});
        		}
			});

			//【取消】按钮
			$("a[class='btn btn-sm']").click(function(){
				cancelSelected();
				$("#send1,#send2").slideUp();
			});
			
			// 模特详细资料层
			$("#model1,#model2").delegate(".inner","click",function(){
				var modelID=$(this).attr("modelID");
				layer.open({
				    type: 2,
				    title:"模特资料",
				    area: ['350px', '520px'],
				    content:  '/index.php/Model/model_info_layer?modelID='+modelID,
				    maxmin: false,
				    shadeClose:true,
				    scrollbar: false,
				});
				return false;
			});
		});
		
		function cancelSelected(){
			$("button[class='btn btn-xs btn-info'],button[class='btn btn-xs btn-primary']").css("border-color","#6fb3e0");
		}
		</script>
	</body>
</html>
