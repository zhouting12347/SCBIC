<include file="Public/header" />
	<body class="no-skin">
		<!-- #section:basics/navbar.layout -->
		<div id="navbar" class="navbar navbar-default">

			<div class="navbar-container" id="navbar-container">
				<!-- #section:basics/sidebar.mobile.toggle -->
				<button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler">
					<span class="sr-only">Toggle sidebar</span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>
				</button>

				<!-- /section:basics/sidebar.mobile.toggle -->
				<div class="navbar-header pull-left">
					<!-- #section:basics/navbar.layout.brand -->
					<a href="#" class="navbar-brand">
						<small>
							<img src="__PUBLIC__/images/cj_logo.png" width="25" height="25">
							东方购物质效考核系统
						</small>
					</a>
					<!-- /section:basics/navbar.layout.brand -->
				</div>
<include file="Public/userbar" />
			</div><!-- /.navbar-container -->
		</div>

		<!-- /section:basics/navbar.layout -->
		<div class="main-container" id="main-container">

			<!-- #section:basics/sidebar -->
			<div id="sidebar" class="sidebar responsive">

<include file="Public/menu" />

				<!-- #section:basics/sidebar.layout.minimize -->
				<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
					<i class="ace-icon fa fa-angle-double-left" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
				</div>

				<!-- /section:basics/sidebar.layout.minimize -->
			</div>

			<!-- /section:basics/sidebar -->
			<div class="main-content">
				<!-- #section:basics/content.breadcrumbs -->
				<div class="breadcrumbs" id="breadcrumbs">
					<!-- /section:basics/content.searchbox -->
				</div>
				<!-- /section:basics/content.breadcrumbs -->
				<div class="page-content">
					<div class="page-content-area">
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
					<div class="row">
						<div class="col-xs-12">
							<div class="table-header" style="background-color: orange;">
								<i class="ace-icon fa fa-table"></i>&nbsp&nbsp待完成任务
							</div>
							<!-- <div class="dataTables_borderWrap"> -->
							<div>
								<table id="table1" class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th>创建时间</th>
												<th>任务名称</th>
												<th>任务状态</th>
												<th>操作</th>
											</tr>
										</thead>
										<tbody>
										<volist name='unfinish_task' id='vo'>
										<tr>
											<td>{$vo.InputDate}</td>
											<td>{$vo.TaskName}</td>
											<td><if condition="($vo.IfSendAudit eq 0) AND ($vo.IfAudit eq 0) AND ($vo.PassOrNot eq 0) ">未提交
													<elseif condition="($vo.IfSendAudit eq 1) AND ($vo.IfAudit eq 0)" />待审核
													<elseif condition="($vo.IfSendAudit eq 0) AND ($vo.IfAudit eq 0) AND ($vo.PassOrNot eq 2)" /> 审核未通过
													</if>
											</td>
											<td>
												<div class="hidden-sm hidden-xs btn-group">
													<button class="btn btn-xs btn-success" id="{$vo.TaskID}">
														<i class="ace-icon fa fa-eye bigger-120"></i>
														查看
													</button>
												</div>
												<if condition="$vo.IfSendAudit eq 0">
													<div class="hidden-sm hidden-xs btn-group">
														<button class="btn btn-xs btn-primary" id="{$vo.TaskID}">
															<i class="ace-icon fa fa-check bigger-120"></i>
															提交
														</button>
													</div>
													<div class="hidden-sm hidden-xs btn-group">
														<button class="btn btn-xs btn-danger" id="{$vo.TaskID}">
															<i class="ace-icon fa fa-times bigger-120"></i>
															删除
														</button>
													</div>
												</if>
											</td>
										</tr>
										</volist>
									</tbody>
								</table>
							</div><!-- end<div class="dataTables_borderWrap"> -->
						</div><!-- end col -->
					</div><!-- end row -->
					<br><br>						
					<div class="row">
						<div class="col-xs-12">
							<div class="table-header">
								<i class="ace-icon fa fa-table"></i>&nbsp&nbsp已完成任务
							</div>
							<!-- <div class="dataTables_borderWrap"> -->
							<div>
								<table id="table2" class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th>创建时间</th>
												<th>任务名称</th>
												<th>任务状态</th>
												<th>操作</th>
											</tr>
										</thead>
										<tbody>
										<volist name='finished_task' id='vo'>
										<tr>
											<td>{$vo.InputDate}</td>
											<td>{$vo.TaskName}</td>
											<td>已完成</td>
											<td>
												<div class="hidden-sm hidden-xs btn-group">
													<button class="btn btn-xs btn-success finished" id="{$vo.TaskID}">
														<i class="ace-icon fa fa-eye bigger-120"></i>
														查看
													</button>
												</div>
											</td>
										</tr>
										</volist>
									</tbody>
								</table>
							</div><!-- end<div class="dataTables_borderWrap"> -->
						</div><!-- end col -->
					</div><!-- end row -->
			
								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content-area -->
				</div><!-- /.page-content -->
			</div><!-- /.main-content -->

<include file="Public/footer" />
	<script type="text/javascript">
		jQuery(function($){
			$('#table1').dataTable({
				searching: true,
				lengthChange: false,
				lengthMenu: [10],
				info: true,
				language:{
		            "url": "/Public/font/zh_CN.txt"
		    	}
			});
			
			 $('#table2').dataTable({
				searching: true,
				lengthChange: false,
				lengthMenu: [10],
				info: true,
				language:{
		            "url": "/Public/font/zh_CN.txt"
		    	}
			}); 
			
			//查看任务详细内容
			$("button[class='btn btn-xs btn-success']").click(function(){
				var taskID=this.id;
				var index = layer.open({
				    type: 2,
				    content: '/index.php/Luzhi/program_table?taskID='+taskID,
				    area: ['300px', '195px'],
				    maxmin: true
				});
				layer.full(index);
			});
			
			//查看已提交的任务
			$("button[class='btn btn-xs btn-success finished']").click(function(){
				var taskID=this.id;
				var index = layer.open({
				    type: 2,
				    content: '/index.php/Public/check_program?controller=Luzhi&taskID='+taskID,
				    area: ['300px', '195px'],
				    maxmin: true
				});
				layer.full(index);
			});
			
			//删除一条总任务
			$("button[class='btn btn-xs btn-danger']").click(function(){
				var taskID=$(this).attr('id');
				layer.confirm('是否删除该条任务?', {icon: 3, title:'提示'}, function(index){
					$.ajax({
						url: '/index.php/Luzhi/delTask?taskID='+taskID,
						dataType: 'json',
						type: 'GET',
						success: function(msg) {
							if(!msg.status){
								//删除失败
								layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
							}else{
								//删除成功
								layer.alert(msg.info, {icon: 1},function(index){location.reload();}); 
							}
						}
					});
				});
			});
			
			//提交任务
			$("button[class='btn btn-xs btn-primary']").click(function(){
				var taskID=$(this).attr('id');
				layer.confirm('是否提交该任务?', {icon: 3, title:'提示'}, function(index){
					$.ajax({
						url: '/index.php/Luzhi/submitTaskHandler?taskID='+taskID,
						dataType: 'json',
						type: 'GET',
						success: function(msg) {
							if(!msg.status){
								//提交失败
								layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
							}else{
								//提交成功
								layer.alert(msg.info, {icon: 1},function(index){location.reload();}); 
							}
						}
					});
				}); 
			});
			
		});
		</script>
	</body>
</html>
