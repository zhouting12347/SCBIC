<include file="Public/header" />
<!-- <link rel="stylesheet" href="__PUBLIC__/css/chosen.css" /> -->
	<body class="no-skin">
		<!-- #section:basics/navbar.layout -->
		<div id="navbar" class="navbar navbar-default">
			<script type="text/javascript">
				try{ace.settings.check('navbar' , 'fixed')}catch(e){}
			</script>

			<div class="navbar-container" id="navbar-container">
				<!-- #section:basics/sidebar.mobile.toggle -->
				<button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler">
					<span class="sr-only">Toggle sidebar</span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>
				</button>

				<!-- /section:basics/sidebar.mobile.toggle -->
				<div class="navbar-header pull-left">
					<!-- #section:basics/navbar.layout.brand -->
					<a href="#" class="navbar-brand">
						<small>
							<img src="__PUBLIC__/images/cj_logo.png" width="25" height="25">
							东方购物质效考核系统
						</small>
					</a>
					<!-- /section:basics/navbar.layout.brand -->
				</div>
<include file="Public/userbar" />
			</div><!-- /.navbar-container -->
		</div>

		<!-- /section:basics/navbar.layout -->
		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<!-- #section:basics/sidebar -->
			<div id="sidebar" class="sidebar responsive">
				<script type="text/javascript">
					try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
				</script>

<include file="Public/menu" />

				<!-- #section:basics/sidebar.layout.minimize -->
				<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
					<i class="ace-icon fa fa-angle-double-left" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
				</div>

				<!-- /section:basics/sidebar.layout.minimize -->
				<script type="text/javascript">
					try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
				</script>
			</div>

			<!-- /section:basics/sidebar -->
			<div class="main-content">
				<!-- #section:basics/content.breadcrumbs -->
				<div class="breadcrumbs" id="breadcrumbs">
					<script type="text/javascript">
						try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
					</script>
					<!-- /section:basics/content.searchbox -->
				</div>
				<!-- /section:basics/content.breadcrumbs -->
				<div class="page-content">
					<div class="page-content-area">
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
<!-- 					<div class="nav-search" id="nav-search">
						<form class="form-search">
							<span class="input-icon">
								<input type="text" placeholder="设备查询 ..." class="nav-search-input" id="nav-search-input" autocomplete="off">
								<i class="ace-icon fa fa-search nav-search-icon"></i>
							</span>
						</form>
					</div> -->
					<br>
					<div class="row">
						<div class="col-xs-12">
							<div class="table-header" style="background-color: rgb(48,126,204);">
								<i class="ace-icon fa fa-table"></i>&nbsp&nbsp
								<if condition="$week eq 'this'">本周任务
								<else />下周任务</if>
							</div>
							<!-- <div class="dataTables_borderWrap"> -->
							<div>
								<table id="table1" class="table table-striped table-bordered table-hover" >
									<thead>
										<tr>
											<tr>
											<th>DATE</th>
											<th>WEEK</th>
											<th>CHANNEL</th>
											<th>TIME</th>
											<th>STUDIO</th>
											<th>PROGRAM</th>
											<th>PD</th>
											<th>SH</th>
											<th>MD</th>
											<th>状态</th>
											<th>外拍时间</th>
											<th>灯光</th>
											<th>摄像</th>
											<th>小蜜蜂</th>
											<th>操作</th>
										</tr>
										</tr>
									</thead>
									<tbody>
									<volist name="program" id="vo">
										<tr>
											<td>{$vo.ProgramDate}</td>
											<td>{$vo.ProgramWeek}</td>
											<td>{$vo.BroadChannel}</td>
											<td>{$vo.BroadTime}</td>
											<td>{$vo.VideoSite}</td>
											<td>{$vo.ProgramReq}</td>
											<td>{$vo.PD}</td>
											<td>{$vo.SH}</td>
											<td>{$vo.MD}</td>
											<td><if condition="$vo.IfGoOut eq 1" >需要外拍<elseif condition="$vo.IfStudioShot eq 1" />棚拍</if></td>
											<td><if condition="$vo.IfGoOut eq 1">{$vo.OutDate}</if></td>
											<td><if condition="$vo.IfLight eq 1" >需要<elseif condition="($vo.IfStudioShot eq 1) OR ($vo.IfGoOut eq 1)" />/</if></td>
											<td><if condition="$vo.IfCamera eq 1" >需要<elseif condition="($vo.IfStudioShot eq 1) OR ($vo.IfGoOut eq 1)" />/</if></td>
											<td><if condition="$vo.IfBee eq 1" >需要<elseif condition="($vo.IfStudioShot eq 1) OR ($vo.IfGoOut eq 1)" />/</if></td>
											<td>
												<if condition="($vo.IfBorrowed eq 0) AND ($vo.IfStudioShot eq '')" >
													<button class="btn btn-xs btn-primary" programID="{$vo.Id}" >需要外拍</button>
													<button class="btn btn-xs btn-success" programID="{$vo.Id}" >棚拍</button>
												</if>
											</td>
										</tr>
									</volist>
								</tbody>
							</table>
							</div><!-- end<div class="dataTables_borderWrap"> -->
						</div><!-- end col -->
					</div><!-- end row -->
					<br>	
					<!-- 棚拍设备借用 -->			
					<div class="widget-box row" id="send1" style="display: none;">
						<div class="widget-header widget-header-flat">
							<h4 class="smaller">可借用设备</h4>
						</div>
						<div class="widget-body col-xs-12">
							<div class="widget-main row">
							<form id="form1" class="form-horizontal" onsubmit="return false">
									<input type="hidden" id="programID" name="Id" value="" />
									<input type="hidden" name="IfBorrowed" value="1" />
									<span class="col-xs-4"></span>
									<div class="form-group col-xs-4">
										<label class="col-xs-3 control-label no-padding-right" for="form-field-1"> 预计归还时间 </label>
										<div class="col-xs-9 input-group" style="padding-left:12px">
											<input type="text" id="form-field-1"  placeholder="选择日期时间" class="form-control"  name="ReturnDate" onClick="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
											<span class="input-group-addon">
												<i class="fa fa-clock-o bigger-110"></i>
											</span>
										</div>
									</div>
									<div class="col-xs-12">
										<div class="form-group col-xs-3">
											<label class="col-xs-3 control-label no-padding-right" for="form-field-select-3">游机</label>
											<div class="col-xs-9">
												<select class="chosen-select" data-placeholder="选择游机..." name="CameraID" >
													<option value="" selected="selected">--选择游机--</option>
													<volist name="equipment" id="vo">
														<if condition="$vo.EquipmentType eq '游机' ">
															<option value="{$vo.Id}">{$vo.EquipmentName}</option>
														</if>
													</volist>
												</select>
											</div>
										</div>
										<div class="form-group col-xs-3">
											<label class="col-xs-3 control-label no-padding-right" for="form-field-select-3" >耳麦</label>
											<div class="col-xs-9">
												<select class="chosen-select"  data-placeholder="选择耳麦..." name="MicroID" >
													<option value="" selected="selected">--选择耳麦--</option>
													<volist name="equipment" id="vo">
														<if condition="$vo.EquipmentType eq '耳麦' ">
															<option value="{$vo.Id}">{$vo.EquipmentName}</option>
														</if>
													</volist>
												</select>
											</div>
										</div>
										<div class="form-group col-xs-3">
											<label class="col-xs-3 control-label no-padding-right" for="form-field-select-3" >小蜜蜂</label>
											<div class="col-xs-9">
												<select class="chosen-select"  data-placeholder="选择小蜜蜂..." name="BeeID" >
													<option value="" selected="selected">--选择小蜜蜂--</option>
													<volist name="equipment" id="vo">
														<if condition="$vo.EquipmentType eq '小蜜蜂' ">
															<option value="{$vo.Id}">{$vo.EquipmentName}</option>
														</if>
													</volist>
												</select>
											</div>
										</div>
										<div class="form-group col-xs-3">
											<label class="col-xs-3 control-label no-padding-right" for="form-field-select-3" >灯光</label>
											<div class="col-xs-9">
												<select class="chosen-select"  data-placeholder="选择灯光..." name="LightID" >
													<option value="" selected="selected">--选择灯光--</option>
													<volist name="equipment" id="vo">
														<if condition="$vo.EquipmentType eq '灯光' ">
															<option value="{$vo.Id}">{$vo.EquipmentName}</option>
														</if>
													</volist>
												</select>
											</div>
										</div>
										<div class="form-group col-xs-3">
											<label class="col-xs-3 control-label no-padding-right" for="form-field-select-3">抠像</label>
											<div class="col-xs-9">
												<select class="chosen-select"  data-placeholder="选择抠像..." name="MattingID">
													<option value="" selected="selected">--选择抠像--</option>
													<volist name="equipment" id="vo">
														<if condition="$vo.EquipmentType eq '抠像' ">
															<option value="{$vo.Id}">{$vo.EquipmentName}</option>
														</if>
													</volist>
												</select>
											</div>
										</div>
									</div>
									<div class="col-xs-12 center">
										<button type="submit" class="btn btn-sm btn-warning">提交</button>
										<button type="reset" class="btn btn-sm" style="margin-left:10px">取消</button>
									</div>
								</form>
							</div>
						</div>
					</div>
					<!-- 导演主持信息表单 End-->	
			
								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content-area -->
				</div><!-- /.page-content -->
			</div><!-- /.main-content -->

<include file="Public/footer" />
<script src="__PUBLIC__/js/chosen.jquery.min.js"></script>
<script src="__PUBLIC__/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript">
	jQuery(function($){
		//加载layer扩展方法
		layer.config({
		    extend: 'extend/layer.ext.js'
		});       
		$("#send1").slideUp(); 
		$('#table1').dataTable({
			searching: true,
			lengthChange: false,
			lengthMenu: [5],
			info: true,
			stateSave: true,//保存表格状态
			language:{
	            "url": "/Public/font/zh_CN.txt"
	    	}
		});
		
		//【设备借用】按钮
		$("button[class='btn btn-xs btn-info']").click(function(){
			cancelSelected();
			$(this).css("border-color","orange");
			$("#programID").val($(this).attr('programID'));
			$("#send1").slideDown();
		});
		
		//【需要外拍】按钮
		$("button[class='btn btn-xs btn-primary']").click(function(){
			var programID=$(this).attr('programID');
			var index = layer.open({
			    type: 2,
			    title:"外拍信息",
			    content:'/index.php/Director/outside_borrow_layer?programID='+programID,
			    area: ['400px', '480px'],
			    maxmin: false
			});
		});
		
		//【提交】按钮
		$("button[class='btn btn-sm btn-warning']").click(function(){
			$.ajax({
				url: '/index.php/Director/borrowEquipmentHandler',
				dataType: 'json',
				type: 'POST',
				data:$('#form1').serialize(),
				success: function(msg) {
					if(!msg.status){
						//操作失败
						layer.alert(msg.info, {icon: 7});
					}else if(msg.status){
						//操作成功
						layer.alert(msg.info, {icon: 1},function(index){location.reload();}); 
					}
				}
			});
			//layer.msg("操作成功！",{time:1300});
			//cancelSelected();
			//$("#send1").slideUp();
		});
		
		//【取消】按钮
		$("button[class='btn btn-sm']").click(function(){
			cancelSelected();
			$("#send1").slideUp();
		});
		
		$('.chosen-select').chosen({allow_single_deselect:true}); 
		//resize the chosen on window resize
		$(window)
		.off('resize.chosen')
		.on('resize.chosen', function() {
			$('.chosen-select').each(function() {
				 var $this = $(this);
				 $this.next().css({'width': $this.parent().width()});
			})
		}).trigger('resize.chosen');
	});
	
	//【查看已借用设备】按钮
	$("button[class='btn btn-xs btn-pink']").click(function(){
		var programID=$(this).attr("programID");
		$.ajax({
			url: '/index.php/Director/checkBorrowEquipment?programID='+programID,
			dataType: 'json',
			type: 'GET',
			success: function(msg) {
				if(msg.status){
					//操作成功
					layer.open({
					    title: '已借用的设备',
					    content: msg.data
					});      
				}
			}
		});
	});
	//【设备归还】 按钮	
	$("button[class='btn btn-xs btn-warning']").click(function(){
		var programID=$(this).attr("programID");
		layer.confirm('是否确定已归还设备?', {icon: 3, title:'提示'}, function(index){
			$.ajax({
				url: '/index.php/Director/returnEquipmentHandler?programID='+programID,
				dataType: 'json',
				type: 'GET',
				success: function(msg) {
					if(!msg.status){
						//提交失败
						layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
					}else{
						//提交成功
						layer.alert(msg.info, {icon: 1},function(index){location.reload();}); 
					}
				}
			});
		});
	});
		
	//【棚拍】 按钮	
	$("button[class='btn btn-xs btn-success']").click(function(){
		var programID=$(this).attr("programID");
		layer.confirm('是否确认为棚拍?', {icon: 3, title:'提示'}, function(index){
			$.ajax({
				url: '/index.php/Director/studioShotHandler?programID='+programID,
				dataType: 'json',
				type: 'GET',
				success: function(msg) {
					if(!msg.status){
						//提交失败
						layer.alert(msg.info, {icon: 2},function(index){location.reload();}); 
					}else{
						//提交成功
						layer.alert(msg.info, {icon: 1},function(index){location.reload();}); 
					}
				}
			});
		});
	});
	
	
	

	
	function cancelSelected(){
		$("button[class='btn btn-xs btn-info']").css("border-color","#6fb3e0");
	}
	</script>
</body>
</html>
